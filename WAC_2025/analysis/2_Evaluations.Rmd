---
title: "2_Evaluations"
output: html_document
date: "2025-10-13"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir='/Users/lkt38/Documents/Github/Alf-IWG_Selection')
```

```{r}
library(MASS)
library(corrplot)
```

Make sure data is normal

```{r}
data <- read.csv('data/Intermediate/data_shared_across_locations.csv')
```

Histograms - Check Normality and Transform

```{r}
colnames(data)

hist(data$Emergence_Stand_count) # left skewed

hist(data$Emergence_Alfalfa_Height) # not normal
hist(log(data$Emergence_Alfalfa_Height)) # bimodal

hist(data$First_Summer_Alfalfa_Height) # bimodal
hist(log(data$First_Summer_Alfalfa_Height)) # bimodal

hist(data$First_Summer_IWG_Height) # outliers
hist(log(data$First_Summer_IWG_Height))

hist(data$First_Summer_Maturity)

hist(data$First_Summer_Alfalfa_Stand_count) # left skewed

hist(data$First_Summer_Lodging) # right skewed
hist(log(data$First_Summer_Lodging)) # uniform

hist(data$First_Yr_Regrowth_Vigor)

hist(data$First_Summer_ALF_Biomass) # right skewed 
hist(sqrt(data$First_Summer_ALF_Biomass))

hist(data$First_Summer_IWG_Biomass) # outlier
hist(log(data$First_Summer_IWG_Biomass))

hist(data$First_Summer_Grain_Biomass)

```

```{r}
data$First_Summer_IWG_Height_log <- log(data$First_Summer_IWG_Height)
data$First_Summer_ALF_Biomass_sqrt <- sqrt(data$First_Summer_ALF_Biomass)
data$First_Summer_IWG_Biomass_log <- log(data$First_Summer_IWG_Biomass)

# make data frame of normal values
data2 <- data[,c('LOC', 'Entry', 'Rep', 'selected', 'selection_location', 'First_Summer_IWG_Height_log', 'First_Summer_Maturity', 'First_Yr_Regrowth_Vigor', 'First_Summer_ALF_Biomass_sqrt', 'First_Summer_IWG_Biomass_log', 'First_Summer_Lodging')]
```

Correlation 

```{r}
correlations = cor(data2[,c(6:ncol(data2))], use = "pairwise.complete.obs")
corrplot.mixed(correlations, order = 'AOE')
## leave blank on non-significant coefficient
## add significant correlation coefficients
testRes = cor.mtest(data2[,c(6:ncol(data2))], conf.level = 0.95)
corrplot(correlations, p.mat = testRes$p, method = 'circle', type = 'lower', insig='blank',
         addCoef.col ='black', number.cex = 0.8, order = 'AOE', diag=FALSE)
```
