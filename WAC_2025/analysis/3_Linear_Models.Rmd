---
title: "3_Linear_Models"
output: html_document
date: "2025-10-13"
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
library(tidyverse)
library(here)
library(multcompView)
library(lmerTest)
library(lme4)
library("PerformanceAnalytics")
library(dplyr)
library(broom.mixed)
```

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = here::here())
```

```{r}
data <- read.csv('data/Intermediate/data_shared_across_locations_transformed.csv')
```

```{r}
data2 <- data %>%
  mutate(selected_cat = case_when(
    selected == "selected" ~ "selected",
    selected == "base" ~ "base",
    TRUE ~ "other"
  ))%>%
  mutate(selected_cat2 = case_when(
    selection_location == "WI" ~ "selectWI",
    selection_location == "KS" ~ "select",
    selection_location == "MN" ~ "select",
    selected == "base" ~ "base",
    TRUE ~ "other"
  ))
data2$selected_cat <- as.factor(data2$selected_cat)
data2$selected_cat2 <- as.factor(data2$selected_cat2)
```

Testing significance of entry on first year traits 

```{r}
# are entries significantly different in first year summer biomass
model <- lmer(First_Summer_ALF_Biomass_sqrt ~ Entry*LOC + (1|LOC:Rep), data=data2)
anova(model)
summary(model)
```

```{r}
# are entries significantly different in first year vigor
model2 <- lmer(First_Yr_Regrowth_Vigor ~ Entry*LOC + (1|LOC:Rep), data=data2)
anova(model2)
summary(model2)
# Entry and Entry*Location interaction were significant
```

```{r}
# do entries selected for intercropping differ than unselected entries
model3 <- lmer(First_Summer_ALF_Biomass_sqrt ~ Entry*LOC + selected_cat + (1|LOC:Rep), data=data2)
anova(model3)
summary(model3)

```

```{r}
# are entries selected for intercropping in Wisconsin different than those selected in other locations
model4 <- lmer(First_Summer_ALF_Biomass_sqrt ~ Entry*LOC + selected_cat2 + (1|LOC:Rep), data=data2)
anova(model4)
summary(model4)
```



try selection as a fixed effect and entry as a random effect in a liklihood ratio test

```{r}
model_Ha <- lmer(First_Summer_ALF_Biomass_sqrt ~ selected_cat + (1 | Entry) + (1|LOC:Rep), data=data2)

model_H0 <- lmer(First_Summer_ALF_Biomass_sqrt ~ 1 + (1 | Entry) + (1|LOC:Rep), data=data2)

anova(model_H0, model_Ha)
```
